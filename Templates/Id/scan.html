{% load static %}

<style>
    /* Body and page layout */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
    }

    /* Fullscreen container for home page */
    .home-page {
        position: relative;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #007bff, #00d4ff); /* Gradient background */
        padding: 20px;
        overflow: hidden;
    }

    .gradient-circle-3,
    .gradient-circle-4 {
        position: absolute;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }

    .gradient-circle-3 {
        top: -100px;
        right: -100px;
    }

    .gradient-circle-4 {
        bottom: -100px;
        left: -100px;
    }

    /* Header styling */
    .header-area {
        width: 100%;
        text-align: center;
        margin-bottom: 30px;
    }

    .header-area h3 {
        font-size: 24px;
        color: #ffffff;
        font-weight: bold;
    }

    .d-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .bi-arrow-left {
        font-size: 1.5rem;
        color: #ffffff;
    }

    /* Recent match notification area */
    .recent-match-area {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 900px;
        text-align: center;
    }

    .match-lists {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .tcn-700 {
        font-size: 16px;
        font-weight: bold;
        color: #ff5722; /* Orange-red for warning */
    }

    /* Enlarged QR Scanner Box */
    #reader {
        text-align: center;
        width: 100%;
        height: 100%;
        margin: 20px auto;
        border: 2px dashed #007bff; /* Thicker blue dashed border */
        border-radius: 12px;
        background-color: rgba(255, 255, 255, 0.2); /* Slight transparency */
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>

<body>
    <section class="home-page">
        <span class="gradient-circle-3"></span>
        <span class="gradient-circle-4"></span>

        <div class="container" style="display: flex; justify-content: center; align-items: center; height: 100vh; text-align: center;">
            <div class="recent-match-area">
                <div class="match-lists">
                    <div class="row mb-3">
                        <div class="col align-self-center">
                            <span class="d-block mb-3 tcn-700" style="font-size: 16px;">⚠️ Scan The QR Code ⚠️</span>
                        </div>
                    </div>

                    <div class="row mb-2">
                        <script src="{% get_static_prefix%}qrScript.js"></script>
                        <div style="text-align: center;">
                            <div id="reader"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Include Html5Qrcode library -->
    <script src="https://unpkg.com/html5-qrcode"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            const csrftoken = getCookie('csrftoken');
            console.log("CSRF Token:", csrftoken);

            // QR Scanner setup
            const html5QrcodeScanner = new Html5Qrcode("reader");
            const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                if (decodedText) {
                    console.log("QR Code Scanned:", decodedText);
                    sendDataToServer(decodedText);
                }
            };

            // Enlarged QR scanner box (400x400)
            const config = { fps: 10, qrbox: { width: 400, height: 400 } };

            html5QrcodeScanner.start({ facingMode: "environment" }, config, qrCodeSuccessCallback)
                .catch(err => {
                    console.error("Camera access error:", err);
                    alert("Camera access failed. Please allow camera permissions.");
                });

            function sendDataToServer(id) {
                fetch("", {
                    method: "POST",
                    body: JSON.stringify({ id: id }),
                    headers: {
                        "X-CSRFToken": csrftoken,
                        "Accept": "application/json, text/plain, */*",
                        "Content-Type": "application/json"
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log("Server Response:", data);

                    if (data["Stat"] == "YES") {
                        window.location.href = "../../../view_scanned_booking/" + data['Link'];
                    } else {
                        alert('No session appended to this card');
                    }
                })
                .catch(error => {
                    console.error("Error sending QR data:", error);
                });
            }
        });

        function see() {
            alert("We are still working on the payment gateways, thank you.");
        }
    </script>
</body>
