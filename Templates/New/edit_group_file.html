{% load static %}


{% include "New/Extra/header.html" %}
      <!-- Content wrapper --> <style>
    .upload-btn-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      cursor: pointer;
      }
      .upload-btn-wrapper input[type=file] {
      font-size: 100px;
      position: absolute;
      left: 0;
      top: 0;
      cursor: pointer;
      width: 50%;
      opacity: 0;
      }
      </style>
      <!-- Content wrapper -->
      <div   class="content-wrapper">

        <!-- Content -->

          <div class="container-xxl flex-grow-1 container-p-y">

 <body  onload="getDate()">
 </body>

<h4  class="py-3 mb-4" >
  <span class="text-muted fw-light">Home/</span>
  File Upload
</h4>
<!-- Sticky Actions -->
<div class="row" >
  <div class="col-12">
    <div class="card">
      <div class="card-header sticky-element bg-label-secondary d-flex justify-content-sm-between align-items-sm-center flex-column flex-sm-row">
        <h5 class="card-title mb-sm-0 me-2">Edit Group File Upload </h5>
        <div class="action-btns">

        </div>
      </div>
      <div class="card-body">
        <form class="row" action="" enctype="multipart/form-data" method="post">
          {% csrf_token %}
          <div class="col-lg-8 mx-auto">
            <!-- 1. Delivery Address -->
            <h5 class="mb-4">File Folder Info</h5>
            <div class="row g-4">
              <div class="col-md-12">
                <div class="form-floating form-floating-outline">
                  <input type="text" id="fullname" required name="Name" value='{{Info.Name}}' class="form-control" placeholder="Python Developer (Full Stack)">
                  <label for="fullname">Files Title</label>
                </div>
              </div>
              <div class="col-md-12">
                <div class="form-floating form-floating-outline">
                 <input type="file" name="Files" class="form-control" multiple>

                  <label for="fullname">Files</label>
                </div>
              </div>
               <div class="card-datatable table-responsive">
              <table id="zero_config" class="table table-striped table-bordered text-nowrap align-middle">
                <thead class="table-light">
                  <tr>
                       <th>ID</th>

                    <th>File Name</th>

                    <th>Time Added</th>
                    <th>Date Added</th>
                    <th>View</th>
                    <th>Download</th>
                  </tr>
                </thead>
                <tbody>



                  {% for i in Files %}
                  <tr>

                      <td>
                      <p>{{i.id}}</p>
                    </td>

                    <td>
                      <p>{{i.Name}}</p>
                    </td>



													<td>{{i.time}}</td>

													<td>{{i.date}}</td>

                    <td class="text-end">
                      <div class="actions">
                        <a href="{% get_media_prefix %}Uploads_Group/{{i.id}}{{i.Extention}}"
   download="{{i.Name}}"
   class="btn btn-sm btn btn-sm bg-danger-light me-2">
                      <button type="submit" class="btn btn-success  waves-effect waves-light"><i class="mdi mdi-tray-arrow-down lh-1 scaleX-n1-rtl" style="padding-right:15px"></i> Download File</button>


</a>

                      </div>
                    </td>
                    <td class="text-end">
                      <div class="actions">

                      <button type="submit" class="btn btn-danger  waves-effect waves-light"><i class="mdi mdi-tray-arrow-down lh-1 scaleX-n1-rtl" style="padding-right:15px"></i> Delete File</button>

                      </div>
                    </td>
                  </tr>
                  {% endfor %}




                </tbody>
              </table>
            </div>

<h5 class="my-4">Shedule Employees</h5>
            <div class="row g-3">

              <div class=" col-10">
                <div class="form-floating form-floating-outline">
                  <select id="MON_N" class="form-control" placeholder="TAKEITALL">

                    {% for i in Client %}
                    <option value="{{i.id}}<*>{{i.Full_Name}}">{{i.Full_Name}} - {{i.Contact}}</option>
                  {% endfor %}
                  </select>

                </div>

              </div>


              <div class="col-sm-2 col-1 d-grid">
                <button onclick="add_list('M')" type="button" class="btn btn-primary">Add</button>
              </div>

              <div class="divider divider-dashed">
                <div class="divider-text">Employees Added</div>
              </div>

              <div class="col-12">
                <ul class="list-group" id="R_Hold">
                   {% for i in Clients %}
                    <li id='R_{{i.User}}' class='list-group-item d-flex justify-content-between align-items-center flex-wrap pb-0 px-0'>
                        <input type="hidden" value="{{i.User}}" name="Staff_{{i.User}}">
                        <div class="d-flex align-items-center" style="padding-left:10px;padding-right:10px;padding-buttom:10px">
                            <img src="{% get_media_prefix %}Profiles/{{i.User}}.jpg" style="object-fit:cover" class="rounded-circle me-3" alt="avatar" height="50" width="50"><div class="user-info">
                                <div>

                                </div>
                        <p class="my-0">{{i.Name}}</p>
                        <span class="text-muted">Employee has been added to this schedule</span>
                        </div></div><h5 class="mb-0"></h5><div class="apply mt-3 mt-sm-0">
                        <button class="btn btn-outline-primary" onclick="del('R_{{i.User}}')">Remove</button></div>
                    </li>
                    {% endfor %}



                </ul>
              </div>
            </div>
            <hr style="padding-top:80px">
              <div class="col-12">
                <div class="form-floating form-floating-outline">
                  <textarea name="About" class="form-control" id="address" rows="5"  style="height: 155px;">{{Info.About}}</textarea>
                  <label for="address">Files Description</label>
                </div>
              </div>

            </div>
            <hr>

            <!-- 2. Delivery Type -->

            </div>


            <!-- 4. Payment Method -->

            <div class="" style="text-align:center;padding-top:30px">
              <button type="submit" class="btn btn-success ">Update Uploaded Files</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- /Sticky Actions -->
          </div>
          <!-- / Content -->


          <input type="hidden" value="9999" id='counter'>
          <input type="hidden" value="0" id='counter1'>
          <input type="hidden" value="0" id='counter2'>
          <input type="hidden" value="0" id='counter3'>
          <input type="hidden" value="0" id='counter4'>
          <input type="hidden" value="0" id='counter5'>
          <input type="hidden" value="0" id='counter6'>

<script>
  function WorkingHours(startTime, endTime) {
    // Parse the start and end times into Date objects
    let start = new Date(`1970-01-01T${startTime}Z`);
    let end = new Date(`1970-01-01T${endTime}Z`);

    // Calculate the difference in milliseconds
    let diffMs = end - start;

    // Convert milliseconds to hours
    let diffHrs = diffMs / (1000 * 60 * 60);

    // Handle cases where the end time is before the start time (crossing midnight)
    if (diffHrs < 0) {
        diffHrs += 24;
    }

    return diffHrs;

  }



  const user_pool = [
      {% for i in Clients %}
      {{i.id}},
      {% endfor %}
      ]
  const schedule_pool = []
  function add_list(id){
    var cu = document.getElementById('counter')
    var name = document.getElementById('MON_N')
    if (id === 'M'){
      if (user_pool.includes(name.value.split('<*>')[0])) {
       alert('user already added to this schedule')

      }else{






        var h = document.getElementById('R_Hold')
        var ne = document.createElement('li')
        ne.setAttribute('class', 'list-group-item d-flex justify-content-between align-items-center flex-wrap pb-0 px-0')
        ne.id='R_'+cu.value
        var ht = '<input type="hidden" value="'+name.value.split('<*>')[0]+'" name="Staff_'+cu.value+'"><div class="d-flex align-items-center" style="padding-left:10px;padding-right:10px;padding-buttom:10px"><img src="{% get_media_prefix %}Profiles/'+name.value.split('<*>')[0]+'.jpg" style="object-fit:cover" class="rounded-circle me-3" alt="avatar" height="50" width="50"><div class="user-info"><div></div><p class="my-0">'+name.value.split('<*>')[1]+'</p><span class="text-muted">Employee has been added to this schedule</span></div></div><h5 class="mb-0"></h5><div class="apply mt-3 mt-sm-0"><button class="btn btn-outline-primary" onclick="del(`R_'+cu.value+'`)">Remove</button></div>'
        var htm = ' <div class="col-10"><input type="text"  required value="'+name.value+'" name="RN_'+cu.value+'" class="form-control" placeholder="TAKEITALL"></div><div class="apply mt-3 mt-sm-0"><button class="btn btn-outline-primary" onclick="del(`R_'+cu.value+'`)">Remove </button></div>'
        ne.innerHTML=ht
        h.append(ne)
        user_pool.push(name.value.split('<*>')[0])
        cu.value=parseInt(cu.value)+1

      }

      } else if (id === 'S'){
        var cu1 = document.getElementById('counter2')
        var name1 = document.getElementById('SUN_N')
        if (schedule_pool.includes(name1.value.split('<*>')[0])) {
         alert('Work slot already added to this schedule')

        }else{






          var h = document.getElementById('S_Hold')
          var ne = document.createElement('li')
          ne.setAttribute('class', 'list-group-item d-flex justify-content-between align-items-center flex-wrap pb-0 px-0')
          ne.id='S_'+cu1.value

          var hr =  WorkingHours(name1.value.split('<*>')[2], name1.value.split('<*>')[3]) - WorkingHours(name1.value.split('<*>')[4], name1.value.split('<*>')[5]) ;
          var ht = '<input type="hidden" value="'+name1.value.split('<*>')[0]+'" name="Sc_'+cu1.value+'"><div class="d-flex align-items-center" style="padding-left:10px;padding-right:10px;padding-buttom:10px"><div class="user-info"><div></div><p class="my-0"><span style="color:white">'+name1.value.split('<*>')[1]+'</span>  <span style="padding-left:100px;">('+hr+' Hours Of Work)</span> </p><span class="text-muted">Working Hours : <span style="color:#51CC20">'+name1.value.split('<*>')[2]+'</span> to <span style="color:#C13839">'+name1.value.split('<*>')[3]+'</span><br>   Break Hours : <span style="color:#51CC20">'+name1.value.split('<*>')[4]+'</span> to <span style="color:#C13839">'+name1.value.split('<*>')[5]+' </span></span></div></div><h5 class="mb-0"></h5><div class="apply mt-3 mt-sm-0"><button class="btn btn-outline-primary" type="button" onclick="del2(`S_'+cu1.value+'`)">Remove</button></div>'


          //var htm = ' <div class="col-10"><input type="text"  required value="'+name1.value+'" name="RN_'+cu1.value+'" class="form-control" placeholder="TAKEITALL"></div><div class="apply mt-3 mt-sm-0"><button class="btn btn-outline-primary" onclick="del(`R_'+cu.value+'`)">Remove </button></div>'
          ne.innerHTML=ht
          h.append(ne)
          schedule_pool.push(name1.value.split('<*>')[0])
          cu1.value=parseInt(cu1.value)+1

        }


    } else if (id === 'T'){
      var name = document.getElementById('TUE_N')
      if (name.value === ""){
        alert('Add A Marker Name!')
      }else{
      var start = document.getElementById('TUE_S1')
      var end = document.getElementById('TUE_S2')

      var cu = document.getElementById('counter1')

      var h = document.getElementById('TUE_Hold')
      var ne = document.createElement('li')
      ne.setAttribute('class', 'list-group-item d-flex justify-content-between align-items-center flex-wrap pb-0 px-0')
      ne.id='TUE_'+cu.value
      var ht = '<input type="hidden" value="'+start.value+'" name="Start_'+cu.value+'"><input type="hidden" value="'+end.value+'" name="End_'+cu.value+'"><input type="hidden" value="'+name.value+'" name="Marker_'+cu.value+'"><div class="d-flex align-items-center" style="padding-left:10px;padding-right:10px;padding-buttom:10px"><p class="my-0">'+name.value+'</p></div></div><h5 class="mb-0"> From '+start.value +' to '+end.value+'</h5><div class="apply mt-3 mt-sm-0"><button class="btn btn-outline-primary" onclick="del(`TUE_'+cu.value+'`)">Delete</button></div>'
     // var htm = ' <div class="col-10"><input type="text"  required value="'+name.value+'" name="RN_'+cu.value+'" class="form-control" placeholder="TAKEITALL"></div><div class="apply mt-3 mt-sm-0"><button class="btn btn-outline-primary" onclick="del(`R_'+cu.value+'`)">Remove</button></div>'
      ne.innerHTML=ht
      h.append(ne)
      name.value=""
      cu.value=parseInt(cu.value)+1
      }

    }


  }
  function getDate(){
    var today = new Date();

document.getElementById("date").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);


}
  function del(id){
    var tb = document.getElementById(id).remove()
    try{
      let index =  user_pool.indexOf(id);

      if (id !== -1) {
        user_pool.splice(index, 1);
        }
    }catch(e){
      console.log(e)

    }
  }
  function del2(id){
    var tb = document.getElementById(id).remove()
    try{
      let index =  schedule_pool.indexOf(id);

      if (id !== -1) {
        schedule_pool.splice(index, 1);
        }
    }catch(e){
      console.log(e)

    }
  }

</script>
{% include "New/Extra/footer.html" %}

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#MON_N').select2({
                placeholder: "Search for a Staff",
                allowClear: true
            });
            $('#SUN_N').select2({
              placeholder: "Search for a Slot",
              allowClear: true
          });
          $('#pb').select2({
            placeholder: "Search for a Branch",
            allowClear: false
        });
        $('#bk').select2({
          placeholder: "Search for a Branch",
          allowClear: false
      });


        });
    </script>
</body>
