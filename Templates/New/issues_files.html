

{% load static %}
<link rel="stylesheet" href="{% get_static_prefix %}New/assets/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
<style>
  .upload-btn-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
  cursor: pointer;
  }
  .upload-btn-wrapper input[type=file] {
  font-size: 100px;
  position: absolute;
  left: 0;
  top: 0;
  cursor: pointer;
  width: 50%;
  opacity: 0;
  }
  </style>

<!-- APP CSS & APP SCSS -->
{% include "New/Extra/header.html" %}

<link rel="stylesheet" href="{% get_static_prefix %}New/assets/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css">

          <!--  Header End -->
          <div class="card shadow-none position-relative overflow-hidden mb-4">
            <div class="card-body d-flex align-items-center justify-content-between p-4">
              <h4 class="card-title mb-0">ISSUE TITLE: <span style="color: brown;"> {{Main.Name}}</span></h4>

            </div>
            <div style="padding-left:30px">
            ISSUE DESCRIPTION: <p>{{Main.About}}</p>
             </div>
             <div style="text-align:center">
    <div class="row" style="padding-left:30px">
        <div class="col-4">
            <div class="form-floating form-floating-outline">
                <select type="text" id="stat" required   class="form-control" placeholder="Python Developer (Full Stack)">
                     <option>{{Main.Status}}</option>
                    <option>Canciled</option>
                     <option>On Hold</option>
                      <option>Completed</option>
                </select>
                <label for="fullname">Files Title</label>
            </div>
        </div>

        <div class="col-4" style="padding-top:5px">
            <a href="#" class="btn bg-info-subtle text-danger w-100 rounded-pill" onclick="update()">Update Status</a>
        </div>
    </div>
</div>

          </div>

          <div class="row">



            <div class="row mb-4 g-4">
              <div class="col-sm-6 col-xl-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="content-left">
                        <h5 class="mb-1">{{C_Image}}</h5>
                        <small>Images</small>
                      </div>
                      <span class="badge bg-label-primary rounded-circle p-2">
                        <i class="ti-image"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="content-left">
                        <h5 class="mb-1">{{C_Video}}</h5>
                        <small>Videos</small>
                      </div>
                      <span class="badge bg-label-success rounded-circle p-2">
                        <i class="ti-desktop"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="content-left">
                        <h5 class="mb-1">{{C_Audio}}</h5>
                        <small>Audio</small>
                      </div>
                      <span class="badge bg-label-danger rounded-circle p-2">
                        <i class="ti-file"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="content-left">
                        <h5 class="mb-1">{{Total}}</h5>
                        <small>All Files</small>
                      </div>
                      <span class="badge bg-label-info rounded-circle p-2">
                         <i class="ti-list"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>




          </div>

            <!-- Referral List Table -->






     <p>Image Files</p>
     <div class="row">

           {% for i in Image %}
            <div class="col-md-6 col-lg-4">
              <div class="card overflow-hidden hover-img">
                <div class="position-relative">

                  <a >

                    <img src="{% get_media_prefix %}Issue_Uploads/{{i.id}}{{i.Extention}}" style="height:350px;object-fit:cover" onerror="this.onerror=null; this.src='{% get_static_prefix %}OIP.jpg';" class="card-img-top" alt="client-img">
                  </a>


                </div>
                 <div class="card-body p-4">


                  <div style="padding-top:10px">
                    <a href="{% get_media_prefix%}Issue_Uploads/{{i.id}}{{i.Extention}}" download="{{Main.Name}}_Image_{{Rand}}.jpg" target="_blank" class="btn bg-primary-subtle text-primary w-100 rounded-pill">Download Image</a>

                  </div>


                </div>



                <div style="padding-top:5px" class="col-12">
                  <a class="btn bg-danger-subtle text-danger w-100 rounded-pill">Delete Image</a>

                </div>



                </div>
              </div>

{% endfor %}
<hr>
<p>Video Files</p>
     <div class="row">

           {% for i in Video %}
            <div class="col-md-6 col-lg-4">
              <div class="card overflow-hidden hover-img">
                <div class="position-relative">

                  <a >

                    <video src="{% get_media_prefix%}Issue_Uploads/{{i.id}}{{i.Extention}}" controls="" style="height:350px;object-fit:cover" class="card-img-top" alt="spike-img"></video>
                  </a>


                </div>

                <div class="card-body p-4">


                  <div style="padding-top:10px">
                    <a href="{% get_media_prefix%}Issue_Uploads/{{i.id}}{{i.Extention}}" download="{{Main.Name}}_Video_{{Rand}}.mp4" target="_blank" class="btn bg-primary-subtle text-primary w-100 rounded-pill">Download Video</a>

                  </div>


                </div>



                <div style="padding-top:5px" class="col-12">
                  <a class="btn bg-danger-subtle text-danger w-100 rounded-pill">Delete Video</a>

                </div>



                </div>
              </div>

{% endfor %}


<p>All Files</p>
 <div class="row">
              <div class="col-12 col-sm-12">
                <div class="card ">



                  <div class="card-body example1-table">
                    <div class="table-responsive">
                      <table id="zero_config" class="table table-striped table-bordered text-nowrap align-middle">
                        <thead>
                          <tr>
                            <th class="font-weight-normal">Name</th>
                            <th class="font-weight-normal">Time</th>
                            <th class="font-weight-normal">Datee</th>


                            <th class="font-weight-normal">Action</th>

                          </tr>
                        </thead>
                        <tbody>

                          {% for i in File %}
                          <tr id='{{i.id}}'>
                            <td>{{i.Name}}</td>
                            <td>{{i.time}}</td>
                            <td>{{i.date}}</td>

                           <td>
                            <a href="{% get_media_prefix%}Issue_Uploads/{{i.id}}{{i.Extention}}" download="{{Client.Full_Name}}-{{Rand}}.pdf" target="_blank" type="button" class="btn bg-primary-subtle text-primary w-100 rounded-pill">Download File</a>
                          </td>

                          </tr>
                          {% endfor %}



                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

</div>
</div>
      <div class="row">



              <nav aria-label="Page navigation example p-0" style="text-align: center;padding-bottom: 100px;">
                <span class="step-links">
                  {% if page_obj.has_previous %}
                    <a class="btn btn-outline-secondary" href="?page=1">&laquo; first</a>
                    <a class="btn btn-outline-secondary" href="?page={{ page_obj.previous_page_number }}">previous</a>
                  {% endif %}

                  <span class="current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                  </span>

                  {% for num in page_obj.paginator.page_range %}
                    {% if num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                      {% if page_obj.number == num %}
                        <span class="btn btn-secondary">{{ num }}</span>
                      {% else %}
                        <a class="btn btn-outline-secondary" href="?page={{ num }}">{{ num }}</a>
                      {% endif %}
                    {% endif %}
                  {% endfor %}

                  {% if page_obj.has_next %}
                    <a class="btn btn-outline-secondary" href="?page={{ page_obj.next_page_number }}">next</a>
                    <a class="btn btn-outline-secondary" href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                  {% endif %}
                </span>
              </nav>


            </div>




        {% include "New/Extra/footer.html" %}



        <!--Internal Echart Plugin -->
        <script src="{% get_static_prefix %}Main/build/assets/plugins/echart/echart.js"></script>

        <!-- Internal index js -->
        <link rel="modulepreload" href="{% get_static_prefix %}Main/build/assets/index-a335dc45.js" /><script type="module" src="{% get_static_prefix %}Main/build/assets/index-a335dc45.js"></script>
        <!-- Select2 js -->
        <script src="{% get_static_prefix %}Main/build/assets/plugins/select2/js/select2.full.min.js"></script>

        <!-- Data tables -->
        <script src="{% get_static_prefix %}Main/build/assets/plugins/datatable/js/jquery.dataTables.min.js"></script>
        <script src="{% get_static_prefix %}Main/build/assets/plugins/datatable/js/dataTables.bootstrap5.js"></script>
        <script src="{% get_static_prefix %}Main/build/assets/plugins/datatable/dataTables.responsive.min.js"></script>
        <script src="{% get_static_prefix %}Main/build/assets/plugins/datatable/responsive.bootstrap5.min.js"></script>


            <!-- Switcher js -->
            <link rel="modulepreload" href="{% get_static_prefix %}Main/build/assets/switcher-d57e6ced.js" /><script type="module" src="{% get_static_prefix %}Main/build/assets/switcher-d57e6ced.js"></script>
            <!-- APP JS-->
        <link rel="modulepreload" href="{% get_static_prefix %}Main/build/assets/app-2392f432.js" />
        <link rel="modulepreload" href="{% get_static_prefix %}Main/build/assets/apexcharts.common-7928d148.js" />
        <script type="module" src="{% get_static_prefix %}Main/build/assets/app-2392f432.js"></script>        <!-- END SCRIPTS -->

            <!-- sticky js-->
        <script src="{% get_static_prefix %}Main/build/assets/sticky.js"></script>


<script>
function update(){
                var state = document.getElementById("stat")
                data = JSON.stringify({
                Status:state.value,
                id:'{{Main.id}}'
                })
                fetch("{% url 'issue_update_status' %}", {
                method: 'POST',
                body: data,
                headers: { 'X-CSRFToken': '{{ csrf_token }}','Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                if (data === 'Ok'){


                    alert("Files has been updated successfully!")

                }else{
                    alert("Please an error occured when updating data!")

                }
                });

              }

    function view_info(id){
      alert(document.getElementById('info'+id).value)
    }

  // vars
 function played(id){
  var img = document.getElementById('plyr-audio-player');
  img.src = '{% get_media_prefix %}Call_Logs/'+id+'.mp3'
 }

  upload1 = document.getElementById("file-input1"),

  upload1.addEventListener('change', (e) => {
    if (e.target.files.length) {

      const reader = new FileReader();
      reader.onload = (e)=> {
        if(e.target.result){
          var img = document.getElementById('plyr-audio-player');
          img.src = e.target.result;


        }
      };
      reader.readAsDataURL(e.target.files[0]);
    }
  });

  </script>



  <div class="modal fade contentmodal" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content doctor-profile">
            <div class="modal-header pb-0 border-bottom-0  justify-content-end">
                <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close"><i class="feather-x-circle"></i></button>
            </div>
            <div class="modal-body">
                <div class="delete-wrap text-center">
                    <div class="del-icon"><i class="feather-x-circle"></i></div>
                    <h4>Type "DELETE" in below to delete this.</h4>
                    <div class="submit-section">
                        <input id="pass2" class="form-control" type="text" id="test" style="text-align: center;">

                    </div>
                    <div style="padding-top: 20px;" class="submit-section">
                        <button onclick="Delete()"  class="btn btn-danger me-2" id="si_button">Delete This</button>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
  <input type="hidden" value="" id='hold_id'>
  <script>
      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  // Does this cookie string begin with the name we want?
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
          }

          const csrftoken = getCookie('csrftoken');
          console.log(csrftoken)
  function setup(id){
    document.getElementById('hold_id').value=id
  }

function Delete(){
  var state = document.getElementById("hold_id")
data = JSON.stringify({
id:state.value,
})
fetch("", {
method: 'DELETE',
body: data,
headers: { 'X-CSRFToken': csrftoken,'Accept': 'application/json, text/plain, */*',
    'Content-Type': 'application/json',
    },
})
.then(response => response.json())
.then(data => {
if (data === 'Ok'){
    document.getElementById(state.value).remove()
    state.value=""
    document.getElementById("pass2").value=""
    alert("Log has been deleted successfully!")
Close()
}else{
    alert("Please an error occured when deleting Log!")

}
});}

setInterval(load_all,1000);
function load_all(){


    var pass2 = document.getElementById("pass2").value
if (pass2==="DELETE"){

 document.getElementById("si_button").disabled = false;
}else{
 document.getElementById("si_button").disabled = true;
}
}




  </script>
      <script src="{% get_static_prefix %}New/assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
      <script src="{% get_static_prefix %}New/assets/js/datatable/datatable-basic.init.js"></script>


      <script type="text/javascript">
    $(document).ready(function() {
        // Initialize DataTable with id 'zep'
        $('#zep').DataTable();
    });







</script>
