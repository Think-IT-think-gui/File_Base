{% load static %}
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css">
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/typeahead-js/typeahead.css" />
    <link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css">
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css">
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css">
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css">
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/select2/select2.css" />
<link rel="stylesheet" href="{% get_static_prefix %}Home/assets/vendor/libs/@form-validation/umd/styles/index.min.css" />
<style>
  .upload-btn-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
  cursor: pointer;
  }
  .upload-btn-wrapper input[type=file] {
  font-size: 100px;
  position: absolute;
  left: 0;
  top: 0;
  cursor: pointer;
  width: 50%;
  opacity: 0;
  }
  </style>
{% include "New/Extra/header.html" %}
      <!-- Content wrapper -->
      <div class="content-wrapper">


        <div class="container-xxl flex-grow-1 container-p-y">




          <!-- Users List Table -->
          <div class="card">
            <div class="card-header border-bottom">
              <h5 class="card-title">Manage Booking</h5>
              <div class="d-flex justify-content-between align-items-center row py-3 gap-3 gap-md-0">
                <div class="col-md-4 user_role"></div>
                <div class="col-md-4 user_plan"></div>
                <div class="col-md-4 user_status"></div>
                <div class="col-4">
            <button class="dt-button add-new btn btn-primary" tabindex="0" aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser"><span><i class="mdi mdi-plus me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Create Booking</span></span></button>

                </div>
              </div>
            </div>
            <div class="card-datatable table-responsive">
              <table class="datatables-users table">
                <thead class="table-light">
                  <tr>
                    <th>Topic</th>
                    <th>Client_Profile</th>
                    <th>Client_Name</th>

                    <th>Associated_Account</th>

                    <th>Contact</th>
                    <th>Location</th>

                    <th>Meeting_Time</th>
                    <th>Meeting_Date</th>

                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>



                  {% for i in Booking %}
                  <tr id={{i.id}}>

                    <td>
                      {{i.Topic}}
                    </td>
                    <td>
                      <p class="table-avatar">
                         {% if i.Type == 'New' %}
                        <a  class="avatar avatar-sm me-2"><img class="avatar-img " src="{% get_media_prefix %}Booking/{{i.id}}.jpg?{{Rand}}" style="width: 60px;height: 60px;object-fit: cover;" alt="User Image"></a>
                         {% else %}
                          <a  class="avatar avatar-sm me-2"><img class="avatar-img " src="{% get_media_prefix %}Profiles/{{i.Type}}.jpg?{{Rand}}" style="width: 60px;height: 60px;object-fit: cover;" alt="User Image"></a>
                         {% endif %}
                      </p>
                    </td>
                    <td>{{i.Name}}</td>


                    <td>
                      {{i.Admin}}
                    </td>

                    <td>{{i.Contact}}</td>


                    <td>{{i.Location}}</td>
                    <td>{{i.Time}}</td>
                    <td>{{i.Date}}</td>


                    <td class="text-end">
                      <div class="actions">
                        <a href="{% url 'view_booking' i.id %}" class="btn btn-sm bg-success-light me-2">
                          <i class="mdi  mdi-eye-arrow-right-outline lh-1 scaleX-n1-rtl"></i>
                        </a>
                        <a href="#" onclick="setup('{{i.id}}')" data-bs-toggle="modal" data-bs-target="#deleteModal" class="btn btn-sm bg-danger-light">
                          <i class="mdi mdi-trash-can-outline lh-1 scaleX-n1-rtl"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}




                </tbody>
              </table>
            </div>

            <!-- Offcanvas to add new user -->
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasAddUser" aria-labelledby="offcanvasAddUserLabel">
              <div class="offcanvas-header">
                <h5 id="offcanvasAddUserLabel" class="offcanvas-title">Schedule Booking</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>
              <div class="offcanvas-body mx-0 flex-grow-0 h-100">
                <form action="" method="post" enctype="multipart/form-data">
                  {% csrf_token %}

                  <div style="text-align: center;"  class="result">
                    <img id='img' style="border-radius: 5px;width:200px;height:200px;object-fit: cover; " src="{% get_static_prefix %}Manager\assets\img\img-02.jpg">

                    </div>
                  <div style="text-align: center;" class="box">
                    <div style="padding-top: 20px;padding-bottom: 20px;"></div>
                    <div class="upload-btn-wrapper">
                    <button  class="btn btn-light btn-block">Select image</button>

                    <input  class="mdc-text-field__input"  id="file-input" style="width: 100%;" required type="file" name="New_Img" accept="image/*" />
                    </div>
                  </div>
                  <div style="padding-top: 10px;"></div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" class="form-control" id="add-user-fullname" placeholder="John Doe" required name="Name" aria-label="John Doe" />
                    <label for="add-user-fullname">Client's Name</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <select type="text" id="add-user-email" class="form-control" placeholder="" aria-label="" name="Gender" required>
                    <option>Male</option>
                    <option>Female</option>

                    </select>
                    <label for="add-user-email">Client's Gender</label>
                  </div>
                  <input type="hidden" class="form-control" placeholder="" aria-label="" name="Type" value="New"/>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" id="add-user-email" class="form-control" placeholder="" aria-label="" name="Location" required />
                    <label for="add-user-email">Client's Address</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" id="add-user-email" class="form-control" placeholder="" aria-label="" name="Contact" required />
                    <label for="add-user-email">Client's Contact</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="text" id="add-user-email" class="form-control" placeholder="" aria-label="" name="Topic" required />
                    <label for="add-user-email">Meeting Subject</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="time" id="add-user-email" class="form-control" placeholder="" aria-label="" name="Time" required />
                    <label for="add-user-email">Schedule Time</label>
                  </div>
                  <div class="form-floating form-floating-outline mb-4">
                    <input type="date" id="add-user-email" class="form-control" placeholder="" aria-label="" name="Date" required />
                    <label for="add-user-email">Schedule Date</label>
                  </div>



                  <div class="form-floating form-floating-outline mb-4">
                    <textarea type="text" id="add-user-email"  class="form-control"  rows="4" cols="50" placeholder="describ the reason for the meeting.." name="About" required ></textarea>
                    <label for="add-user-email">Meeting Description</label>
                  </div>

                  <button type="submit" class="btn btn-primary me-sm-3 me-1 data-submit">Submit</button>
                  <button type="reset" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                </form>
              </div>
            </div>
          </div>




      </div>
          <!-- / Content -->

          <script>

            upload = document.getElementById("file-input"),
            upload.addEventListener('change', (e) => {
              if (e.target.files.length) {
              const reader = new FileReader();
              reader.onload = (e)=> {
                if(e.target.result){
                let img = document.getElementById('img');
                img.src = e.target.result;
                }
              };
              reader.readAsDataURL(e.target.files[0]);
              }
            });


            </script>
            <div class="modal fade contentmodal" id="deleteModal" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content doctor-profile">
                      <div class="modal-header pb-0 border-bottom-0  justify-content-end">
                          <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close"><i class="feather-x-circle"></i></button>
                      </div>
                      <div class="modal-body">
                          <div class="delete-wrap text-center">
                              <div class="del-icon"><i class="feather-x-circle"></i></div>
                              <h4>Type "DELETE" in below to delete this.</h4>
                              <div class="submit-section">
                                  <input id="pass2" class="form-control" type="text" id="test" style="text-align: center;">

                              </div>
                              <div style="padding-top: 20px;" class="submit-section">
                                  <button onclick="Delete()"  class="btn btn-danger me-2" id="si_button">Delete This</button>

                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
            <input type="hidden" value="" id='hold_id'>
            <script>
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                    }

                    const csrftoken = getCookie('csrftoken');
                    console.log(csrftoken)
            function setup(id){
              document.getElementById('hold_id').value=id
            }

      function Delete(){
            var state = document.getElementById("hold_id")
          data = JSON.stringify({
          id:state.value,
          })
          fetch("{% url 'delete_booking' %}", {
          method: 'POST',
          body: data,
          headers: { 'X-CSRFToken': csrftoken,'Accept': 'application/json, text/plain, */*',
              'Content-Type': 'application/json',
              },
          })
          .then(response => response.json())
          .then(data => {
          if (data === 'Ok'){
              document.getElementById(state.value).remove()
              state.value=""
              document.getElementById("pass2").value=""
              alert("Schedule has been deleted successfully!")
          Close()
          }else{
              alert("Please an error occured when deleting Schedule!")

          }
          });}

          setInterval(load_all,1000);
          function load_all(){


              var pass2 = document.getElementById("pass2").value
          if (pass2==="DELETE"){

           document.getElementById("si_button").disabled = false;
          }else{
           document.getElementById("si_button").disabled = true;
          }
          }

            </script>


{% include "New/Extra/footer.html" %}


<!-- endbuild -->

<!-- Vendors JS -->


<!-- Main JS -->
<script src="{% get_static_prefix %}Home/assets/js/main.js"></script>


<!-- Page JS -->
<script src="{% get_static_prefix %}Home/assets/js/app-user-list.js"></script>